<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secure Server</title>
  <style>
    html {
      height: 100%;
    }
    body {
    background-color: black;
    color: #00FF00;
    font-family: 'Courier New', Courier, monospace;
    font-size: clamp(14px, 2.5vw, 15px); /* Slightly smaller max font-size for a more 'zoomed-out' feel */
    margin: 0;
    padding: 10px; /* Reduced padding for more content space on mobile */
    white-space: pre-wrap;
    position: relative;
    animation: flicker 0.2s infinite;
    min-height: 100%; /* Use min-height for better layout stability with virtual keyboards */
    box-sizing: border-box;
    }

    #terminal {
    max-width: 900px;
    margin: auto;
    position: relative;
    z-index: 2;
    filter: drop-shadow(0 0 4px #00FF00);
    }

    .centered-line {
      text-align: center;
    }

    .input-line {
    display: flex;
    padding: 5px 0; /* Add some vertical space to the input line */
    }

    .input-line span {
    flex-shrink: 0;
    }

    .input-line input {
    background: black;
    border: none;
    color: #00FF00;
    font-family: inherit;
    font-size: inherit;
    outline: none;
    flex-grow: 1;
    }

    /* CRT Flicker */
    @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.98; }
    60% { opacity: 0.95; }
    70% { opacity: 0.97; }
    80% { opacity: 0.96; }
    90% { opacity: 0.99; }
    }

    /* Scanlines */
    body::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
      to bottom,
      rgba(0, 255, 0, 0.05),
      rgba(0, 255, 0, 0.05) 2px,
      transparent 2px,
      transparent 4px
    );
    z-index: 1;
    pointer-events: none;
    }

    /* Radial glow for curvature */
    body::after {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, rgba(0, 255, 0, 0.05), transparent 70%);
    z-index: 0;
    pointer-events: none;
  }
  </style>
</head>
<body>
  <div id="terminal"></div>
  <div class="input-line">
    <span>&gt; </span>
    <input id="terminal-input" autofocus />
  </div>

  <script>
    const terminal = document.getElementById('terminal');
    const input = document.getElementById('terminal-input');

    const initialWelcomeHTML = `MATTHEW IGLODY | SECURE SERVER | (TM) SECLINK PROTOCOL
<div class="centered-line">------- ONE TIME PASSWORD ACCEPTED -------</div>

> WELCOME USER

<div class="centered-line">--- ACCESSING PROFESSIONAL PORTFOLIO SYSTEM ---</div>

INITIALIZING SYSTEM...
SYSTEM STATUS: STABLE
USER PRIVILEGES: READ/VIEW/NAVIGATE

> SYSTEM ONLINE.
> TYPE "help" FOR AVAILABLE COMMANDS.`;

    // Focus the input when the user clicks/taps anywhere on the terminal body
    document.body.addEventListener('click', (event) => {
      // If the user clicks on something that is not the input itself, focus the input.
      // This is to avoid interfering with text selection inside the input field.
      if (event.target !== input) {
        input.focus();
      }
    });

    let awaitingResponseFor = null; // State for multi-step commands

    const commandHistory = [];

    const logs = [
      "[LOG 1 - 07/24/2077 13:04:02] Overseer reports Vault 112 social conditioning protocol is proceeding as planned.",
      "[LOG 2 - 07/25/2077 08:45:30] Internal sensor calibration completed. Minor anomalies in oxygen circulation flagged.",
      "[LOG 3 - 07/25/2077 16:12:59] Unauthorized attempt to access cryo chamber controls. Technician ID #0043.",
      "[LOG 4 - 07/26/2077 00:03:11] ALERT: Security lockdown initiated. Emergency protocol ZETA-5 activated.",
      "[LOG 5 - 07/26/2077 06:27:41] Power fluctuation detected in Sector C3. Engineering dispatched.",
      "[LOG 6 - 07/26/2077 09:15:20] Overseer broadcast: 'Remain calm. This is a containment drill.'",
      "[LOG 7 - 07/26/2077 12:52:14] Multiple failed login attempts from unrecognized terminal.",
      "[LOG 8 - 07/26/2077 18:34:57] Cryo Pod #12 suspension terminated. Medical team dispatched.",
      "[LOG 9 - 07/27/2077 02:17:04] Temperature spike in cryogenics bay. Fire suppression holding.",
      "[LOG 10 - 07/27/2077 05:39:33] Coolant leak in sub-level. Repairs underway.",
      "[LOG 11 - 07/27/2077 08:00:00] Surface beacon pinged. No signal response. Possible comms malfunction.",
      "[LOG 12 - 07/27/2077 10:22:18] Vault entrance locked. Unrecognized biometric access attempt logged.",
      "[LOG 13 - 07/27/2077 13:14:45] Cafeteria nutrient dispenser malfunction. Manual override successful.",
      "[LOG 14 - 07/27/2077 15:48:02] Resident anxiety levels elevated. Increasing recreational programs.",
      "[LOG 15 - 07/27/2077 20:01:59] Motion detected in corridor 7-B. No personnel scheduled. Drone dispatched."
    ];

    const menuItems = [
      "1. Bio - [TYPE 'bio' to view]",
      "2. Contact - [TYPE 'contact' to view]",
      "3. Work History - [TYPE 'workhistory' to view]",
      "4. [Placeholder for Project 4]",
      "5. [Placeholder for Project 5]"
    ];

    const commandDescriptions = {
      'help': 'List available commands',
      'bio': 'Display my professional bio',
      'contact': 'Display my contact information',
      'workhistory': 'Display my professional work history',
      'logs': 'Display command history with timestamps',
      'menu': 'Display a list of portfolio items',
      'transfer': 'Open my CV in a new tab',
      'clear': 'Clear the terminal and reset to welcome screen',
      'exit': 'Close the terminal interface'
    };

    const workHistoryDetails = {
      '1': {
        title: 'Role 1: [Your Title Here]',
        description: 'Placeholder text for your first role. Describe your responsibilities and achievements here.'
      },
      '2': {
        title: 'Role 2: [Your Title Here]',
        description: 'Placeholder text for your second role. Describe your responsibilities and achievements here.'
      },
      '3': {
        title: 'Role 3: [Your Title Here]',
        description: 'Placeholder text for your third role. Describe your responsibilities and achievements here.'
      },
      '4': {
        title: 'Role 4: [Your Title Here]',
        description: 'Placeholder text for your fourth role. Describe your responsibilities and achievements here.'
      }
    };

    function printWelcomeMessage() {
      terminal.innerHTML = initialWelcomeHTML;
    }

    function typewriterEffect(text, onComplete) {
      let i = 0;
      input.disabled = true; // Disable input while typing
      const typingInterval = setInterval(() => {
        if (i < text.length) {
          terminal.innerText += text.charAt(i);
          i++;
          window.scrollTo(0, document.body.scrollHeight);
        } else {
          clearInterval(typingInterval);
          if (onComplete) onComplete();
        }
      }, 30); // Adjust typing speed here (in milliseconds)
    }

    function downloadTranscript() {
      // We grab the innerText of the terminal, but add a final message.
      const transcriptContent = terminal.innerText + "\n\n--- TRANSCRIPT END ---";
      const blob = new Blob([transcriptContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
      link.download = `terminal-session-${timestamp}.txt`;
      link.href = url;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      terminal.innerText += `\nDownloading transcript...`;
    }

    function handleResponse(response) {
      switch (awaitingResponseFor) {
        case 'exit_confirm':
          if (response === 'y' || response === 'yes') {
            terminal.innerText += `\nWould you like a transcript of your activity? (y/n)`;
            awaitingResponseFor = 'transcript_prompt';
          } else {
            terminal.innerText += `\nExit cancelled.\n\n`;
            awaitingResponseFor = null;
          }
          break;
        case 'transcript_prompt':
          if (response === 'y' || response === 'yes') {
            downloadTranscript();
          }
          // Instead of exiting, ask for final confirmation.
          terminal.innerText += `\n\nAre you sure you want to terminate the session? (y/n)`;
          awaitingResponseFor = 'final_exit_confirm';
          break;
        case 'final_exit_confirm':
          if (response === 'y' || response === 'yes') {
            terminal.innerText += `\n\nSESSION TERMINATED.\nGOODBYE.`;
            input.disabled = true;
            setTimeout(() => window.close(), 2000);
            awaitingResponseFor = null;
          } else {
            terminal.innerText += `\nExit cancelled.\n\n`;
            awaitingResponseFor = null;
          }
          break;
        case 'workhistory_select':
          if (response === 'back') {
            terminal.innerText += `\nReturning to main prompt.\n\n`;
            awaitingResponseFor = null;
            break;
          }
          const job = workHistoryDetails[response];
          if (job) {
            awaitingResponseFor = null; // Valid selection, so we're done with the prompt.
            const fullText = `${job.title}\n----------------------------------------\n${job.description}`;
            typewriterEffect(fullText, () => {
              terminal.innerText += "\n\n";
              input.disabled = false;
              input.focus();
            });
          } else {
            terminal.innerText += `\nInvalid selection. Please enter a number from the list or type 'back' to return.\n\n`;
            // Don't reset awaitingResponseFor, so the user can try again.
          }
          break;
      }
    }

    input.addEventListener('keydown', function(event) {
      if (event.key !== 'Enter') return;

      const commandText = input.value.trim().toLowerCase();
      if (commandText === '') return;

      terminal.innerText += `\n> ${input.value.trim()}`; // Display original casing

      if (awaitingResponseFor) {
        terminal.innerText += `\n`;
        handleResponse(commandText);
      } else {
        terminal.innerText += `\n`;
        commandHistory.push({ text: input.value.trim(), timestamp: new Date() });
        handleCommand(commandText);
      }

      input.value = '';
      window.scrollTo(0, document.body.scrollHeight);
    });

    printWelcomeMessage();

    const commands = {
      help: () => {
        return 'AVAILABLE COMMANDS:\n' + Object.entries(commandDescriptions)
          .map(([command, description]) => `- ${command} : ${description}`)
          .join('\n');
      },
      bio: () => {
        const bioText = "This is where your bio paragraph will go. You can replace this text with your own personal or professional summary. It will be typed out character by character to simulate a retro terminal display.";
        typewriterEffect(bioText, () => {
          // This function runs after the typing is complete
          terminal.innerText += "\n\n"; // Add spacing after the bio
          input.disabled = false; // Re-enable the input field
          input.focus(); // Focus on the input field for the next command
          window.scrollTo(0, document.body.scrollHeight);
        });
        return null; // Signal that output is handled asynchronously
      },
      contact: () => {
        const contactText = "Cell: 732-573-8567\nEmail: mattiglody@gmail.com";
        typewriterEffect(contactText, () => {
          // This function runs after the typing is complete
          terminal.innerText += "\n\n"; // Add spacing after the contact info
          input.disabled = false; // Re-enable the input field
          input.focus(); // Focus on the input field for the next command
          window.scrollTo(0, document.body.scrollHeight);
        });
        return null; // Signal that output is handled asynchronously
      },
      workhistory: () => {
        awaitingResponseFor = 'workhistory_select';
        const jobList = Object.entries(workHistoryDetails)
          .map(([key, value]) => `${key}. ${value.title}`)
          .join('\n');
        return `WORK HISTORY:\n${jobList}\n\nEnter a number to learn more, or type 'back' to return.`;
      },
      menu: () => menuItems.join("\n"),
      transfer: () => {
        const filePath = 'docs/Matthew_E_Iglody_2025_CV.pdf';
        // Open the file in a new tab. The browser's built-in PDF viewer will handle it.
        window.open(filePath, '_blank');
        return "ACCESSING DOCUMENT...\nOPENING CV IN NEW TAB.";
      },
      logs: () => {
        // Exclude the 'logs' command itself from the output for a cleaner history view.
        if (commandHistory.length <= 1) {
          return "No previous commands in history.";
        }
        return commandHistory.slice(0, -1).map(entry => {
          const time = entry.timestamp.toLocaleTimeString('en-US', { hour12: false });
          return `[${time}] ${entry.text}`;
        }).join("\n");
      },
      exit: () => {
        awaitingResponseFor = 'exit_confirm';
        return "Are you sure you want to exit? (y/n)";
      },
    };

    function handleCommand(cmd) {
      // The 'clear' command is special as it modifies the terminal directly
      if (cmd === 'clear') {
        printWelcomeMessage();
        return;
      }

      const commandFn = commands[cmd];
      if (!commandFn) {
        terminal.innerText += `Unrecognized command: '${cmd}'\nType 'help' for options.\n\n`;
        return;
      }

      const output = commandFn();

      // If a command returns null, it handles its own output (e.g., typewriter)
      if (output === null) return;

      // The 'help' command's output is multi-line, so it only needs one trailing newline for spacing.
      const trailingNewlines = (['help', 'exit', 'workhistory'].includes(cmd)) ? "\n" : "\n\n";
      terminal.innerText += output + trailingNewlines;
    }
  </script>
</body>
</html>
